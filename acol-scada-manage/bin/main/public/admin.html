<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>上海埃科临时演示页面</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<!--  -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
<link href="css/plugins/iCheck/custom.css" rel="stylesheet">
<link href="css/plugins/steps/jquery.steps.css" rel="stylesheet">
<link href="css/animate.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link href="css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">

 <link href="css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
<!--  

<link href="font-awesome/css/font-awesome.css" rel="stylesheet">

<link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">

<link href="css/animate.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">-->

</head>

<body>

	<div id="wrapper">
		<nav class="navbar-default navbar-static-side" role="navigation">
			<div class="sidebar-collapse">
				<ul class="nav metismenu" id="side-menu">
					<li class="nav-header">
						<div class="dropdown profile-element">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#"> <span
								class="clear"> <span class="block m-t-xs"> <strong
										class="font-bold">superAdmin</strong>
								</span> <span class="text-muted text-xs block">操作 <b
										class="caret"></b></span>
							</span>
							</a>
							<ul class="dropdown-menu animated fadeInRight m-t-xs">
								<li><a href="./logout">注销</a></li>
							</ul>
						</div>
						<div class="logo-element">IN+</div>
					</li>
					<li class="active">
						
						<a><i class="fa fa-th-large"></i> <span class="nav-label">设备管理</span></a>
						<ul class="nav nav-second-level collapse">
							<li><a href="scadaInfor.html">设备信息</a></li>
							<li><a href="scadaController.html">设备远程控制</a></li>
						</ul>
					</li>
					
					<li class="active">
						<a><i class="fa fa-user"></i> <span class="nav-label">管理员</span></a>
						<ul class="nav nav-second-level collapse">
							<li><a href="admin.html">快速添加设备</a></li>
							<li><a href="price.html">价格方案制定</a></li>
						</ul>
					</li>
						
				</ul>

			</div>
		</nav>

		<div id="page-wrapper" class="gray-bg">
			<div class="row border-bottom">
				<nav class="navbar navbar-static-top white-bg" role="navigation"
					style="margin-bottom: 0">
					<div class="navbar-header">
						<a class="navbar-minimalize minimalize-styl-2 btn btn-primary "
							href="#"><i class="fa fa-bars"></i> </a>
						<form role="search" class="navbar-form-custom" method="post"
							action="#">
							<div class="form-group">
								<input type="text" placeholder=""
									class="form-control" name="top-search" id="top-search">
							</div>
						</form>
					</div>
					<ul class="nav navbar-top-links navbar-right">
						<li><a href="./logout"> <i class="fa fa-sign-out"></i> 注销
						</a></li>
					</ul>

				</nav>
			</div>
			<!-- <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-center m-t-lg">
                        <h1>
                            Simple example of second view
                        </h1>
                        <small>Writen in minor.html file.</small>
                    </div>
                </div>
            </div>
        </div> -->
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-lg-10">
					<h2>设备整体运行情况信息展示</h2>
					<ol class="breadcrumb">
						<li><a href="index.html">设备管理</a></li>
						<li><a>设备信息</a></li>
						<li class="active"><strong>信息展示</strong></li>
					</ol>
				</div>
				<div class="col-lg-2"></div>
			</div>
			<div class="wrapper wrapper-content animated fadeInRight">
				<div class="row">
					  <div class="col-lg-12">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>管理员操作流程</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i>
									</a> <a class="dropdown-toggle" data-toggle="dropdown" href="#">
										<i class="fa fa-wrench"></i>
									</a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="#">将所有设备初始化为出厂设置</a></li>
									</ul>
									<a class="close-link"> <i class="fa fa-times"></i>
									</a>
								</div>
							</div>
							
							
							<div class="ibox-content">
		                       <h2>
                                	管理员用户注册
                            </h2>
                            <p>
                                  	仔细阅读模式后再进行填写
                            </p>
                            <form id="adminForm" action="#" class="wizard-big">
                                <h1>管理员帐号</h1>
                                <fieldset>
                                    <h2>帐号信息填写</h2>
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <div class="form-group">
                                                <label>用户名 *</label>
                                                <input id="username" name="userName" type="text" class="form-control required">
                                            </div>
                                            <div class="form-group">
                                                <label>密码 *</label>
                                                <input id="password" name="password" type="text" class="form-control required">
                                            </div>
                                            <div class="form-group">
                                                <label>确认 密码 *</label>
                                                <input id="confirm" name="confirm" type="text" class="form-control required">
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="text-center">
                                                <div style="margin-top: 20px">
                                                    <i class="fa fa-sign-in" style="font-size: 180px;color: #e5e5e5 "></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <h1>基本信息</h1>
                                <fieldset>
                                    <h2>基本信息填写</h2>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label> 姓名  *</label>
                                                <input id="name" name="name" type="text" class="form-control required">
                                            </div>
                                            <div class="form-group">
                                                <label>详细地址 *</label>
                                                <input id="address" name="address" type="text" class="form-control required">
                                            </div>
                                            <div class="form-group">
                                                <label>电话号码  *</label>
                                                <input id="phone" name="phone" type="text" class="form-control required">
                                            </div>
                                            
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>邮箱  *</label>
                                                <input id="email" name="email" type="text" class="form-control required email">
                                            </div>
                                            <div class="form-group">
                                                <label>手机号  *</label>
                                                <input id="mobile" name="mobile" type="text" class="form-control">
                                            </div>
                                            <div class="form-group">
								                <label class="font-normal">角色选择</label>
								           	 	<div>
									                <select id="roles" data-placeholder="选择一个用户角色" class="chosen-select" multiple style="width:350px;" tabindex="4">
								                	</select>
								             	</div>
                                       		 </div>
                                       </div>
                                    </div>
                                </fieldset>

                                <h1>警告</h1>
                                <fieldset>
                                    <div class="text-center" style="margin-top: 120px">
                                        <h2>信息填写有误，重新填写完整信息 注意：一定要选择一个角色  
                                        	<br/>手机号11位数字：且13 14 15 17 18 开头</h2>
                                    </div>
                                </fieldset>

                                <h1>完成</h1>
                                <fieldset>
                                    <h2>确认添加</h2>
                                    <input id="acceptTerms" name="acceptTerms" type="checkbox" class="required"> <label for="acceptTerms">了解，并确认此帐号用于正常用途</label>
                                </fieldset>
                            </form>
		                    </div>
		                    
		                    <div class="ibox-content">
		                       <h2>
                                	公司信息填写
                            </h2>
                            <p>
                                  	仔细阅读模式后再进行填写
                            </p>
                            <form id="companyForm" action="#" class="wizard-big">
                                <h1>添加公司</h1>
                                <fieldset>
                                    <h2>公司基本信息填写</h2>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>公司名 *</label>
                                                <input id="companyName" name="companyName" type="text" class="form-control required">
                                            </div>
                                            <div class="form-group">
                                                <label>电话 *</label>
                                                <input id="telephone" name="phone" type="text" class="form-control required">
                                            </div>
                                           
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>地址 *</label>
                                                <input id="companyAddress" name="address" type="text" class="form-control required">
                                            </div>
                                             <div class="form-group">
								                <label class="font-normal">选择管理员帐号</label>
								                <div>
									                <select id="usernames" data-placeholder="选择管理管理员帐号" class="chosen-select"  tabindex="2">
								                </select>
								                </div>
								             </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <h1>警告</h1>
                                <fieldset>
                                    <div class="text-center" style="margin-top: 120px">
                                        <h2>为公司选择一个管理员</h2>
                                    </div>
                                </fieldset>
                                <h1>完成</h1>
                                <fieldset>
                                    <h2>确认添加</h2>
                                    <input id="acceptTerms" name="acceptTerms" type="checkbox" class="required"> <label for="acceptTerms">了解，并确认公司要入驻本系统</label>
                                </fieldset>
                            </form>
		                    </div>
		                    
		                     <div class="ibox-content">
		                       <h2>
                                	添加一个设备
                            </h2>
                            <p>
                                  	添加设备
                            </p>
                            <form id="deviceForm" action="#" class="wizard-big">
                                <h1>添加设备</h1>
                                <fieldset>
                                    <h2>设备基本信息填写</h2>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>设备号 *</label>
                                                <input id="scaNum" name="scaNum" type="text" class="form-control required">
                                            </div>
                                            
                                            <div class="form-group">
								                <label class="font-normal">设备通讯类型</label>
								                <div>
									                <select id="colType" data-placeholder="选择管理管理员帐号" class="chosen-select"  tabindex="2">
									                	<option value="485"> 485 </option>
														<option value="422"> 422 </option>
								               		 </select>
								                </div>
								             </div>
								             <div class="form-group">
								                <label class="font-normal">选择公司帐号</label>
								                <div>
									                <select id="companys" data-placeholder="选择设备归属公司" class="chosen-select"  tabindex="2">
								                </select>
								                </div>
								             </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>客户简称</label>
                                                <input id="customerName" name="customerName" type="text" class="form-control">
                                            </div>
                                            <div class="form-group">
                                                <label>客户地址 </label>
                                                <input id="customerAddress" name="customerAddress" type="text" class="form-control">
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                 <h1>价格模式设置</h1>
                                <fieldset>
                                	 <div class="col-lg-8">
                                	 		<p>设备类型选择</p>
	                                        <div class="radio radio-info radio-inline">
	                                            <input type="radio" id="inlineRadio1" value="option1" name="radioInline" checked="checked">
	                                            <label for="inlineRadio1"> IC远程预付费设备 </label>
	                                        </div>
	                                        <div class="radio radio-inline">
	                                            <input type="radio" id="inlineRadio2" value="option2" name="radioInline">
	                                            <label for="inlineRadio2"> 数据采集设备 </label>
	                                        </div>
                                            <div class="form-group">
								                <label class="font-normal">选择要启用的计价方案   *</label>
								                <div>
									                <select id="pricePlan" data-placeholder="计价方案" class="chosen-select"  tabindex="2">
									                <option value="-1"> 此设备无需方案 </option>
								                </select>
								                </div>
								             </div>
								             <div class="form-group">
								                <label class="font-normal">选择计划要实行的计价方案</label>
								                <div>
									                <select id="exPricePlan" data-placeholder="计价方案" class="chosen-select"  tabindex="2">
									                <option value="-1"> 没有计划方案 </option>
								                </select>
								                </div>
								             </div>
                                     </div>
                                     <div class="col-lg-4">
                                            <div class="text-center">
                                                <div style="margin-top: 20px">
                                                    <i class="fa fa-sign-in" style="font-size: 180px;color: #e5e5e5 "></i>
                                                </div>
                                            </div>
                                      </div>
                                </fieldset>
                                <h1>警告</h1>
                                <fieldset>
                                    <div class="text-center" style="margin-top: 120px">
                                        <h2>选择IC远程预付费设备时 必须要选择一个要启用的计价方案
                                        <br>数据采集设备：不支持计价和阀控  将忽视计价方案</h2>
                                    </div>
                                </fieldset>
                                <h1>完成</h1>
                                <fieldset>
                                    <h2>确认添加</h2>
                                    <input id="acceptTerms" name="acceptTerms" type="checkbox" class="required"> <label for="acceptTerms">确认此设备将用于实际使用中</label>
                                </fieldset>
                            </form>
		                    </div>
						</div>
						
					</div>
					
				</div>
			</div>
			<div class="footer">
				<div class="pull-right">
					沪公网安备  <strong>31011702000479</strong> 号
				</div>
				<div>
					公司名 <strong>上海埃科燃气测控设备有限公司</strong> &copy; 2000-2019
				</div>
			</div>

		</div>
	</div>

	<!-- Mainly scripts -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
	<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js"></script>
	<!-- Custom and plugin javascript -->
	<script src="js/inspinia.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
	<!-- Chosen -->
    <script src="js/plugins/chosen/chosen.jquery.js"></script>
	<!-- Steps -->
    <script src="js/plugins/steps/jquery.steps.min.js"></script>
    
    <!-- Jquery Validate -->
    <script src="js/plugins/validate/jquery.validate.min.js"></script>
    <script src="js/core.js"></script>
	<!-- Page-Level Scripts -->
	<script type="text/javascript">
		
		var isRoleSelect = false;//角色是否有查询过
		var isAdminSelect = false;//管理员帐号是否查询过
		
		$(document).ready(function(){
			
			$.get('./admin/getAdmins',function success(data){
				//alert(data);
				var option = "";
				$.each(data, function(index, item) {
					option+= "<option value='"+item.username+"'>" + item.username+ "</option>";
				});
				//alert(option);
				 $("#usernames").append(  //此处向select中循环绑定数据
         		  option);
				 $('#usernames').chosen({width: "100%"});
			});
			$.get('./role',function success(data){
				//alert(data);
				isRoleSelect = true;
				var option = "";
				$.each(data, function(index, item) {
					option+= "<option value='"+item.id+"'>" + item.name+ "</option>";
				});
				
				 $("#roles").append(  //此处向select中循环绑定数据
         		  option);
				 $('#roles').chosen({width: "100%"});
			});
			$.get('./company',function success(data){
				//alert(data);
				var option = "";
				$.each(data, function(index, item) {
					option+= "<option value='"+item.id+"'>" + item.companyName+ "</option>";
				});
				 $("#companys").append(  //此处向select中循环绑定数据
         		  option);
			});
			$.get('./price',function success(data){
				//alert(data);
				var option = "";
				var exOption = "";
				$.each(data, function(index, item) {
					
					if(item.exDate<=new Date().getTime()){//立即执行的方案
						option+= "<option value='"+item.id+"'>" + item.planName+ "</option>";
						exOption+= "<option value='"+item.id+"'>" + item.planName+ "</option>";
					}else{
						exOption+= "<option value='"+item.id+"'>" + item.planName+ "</option>";
					}
				});
				 $("#pricePlan").append(
		         		  option);
				 $("#exPricePlan").append(exOption);
				
			});
			
			
			
			$("#adminForm").steps({
                bodyTag: "fieldset",
                onStepChanging: function (event, currentIndex, newIndex) 
                {
                    // Always allow going backward even if the current step contains invalid fields!
                    if (currentIndex > newIndex)
                    {
                        return true;
                    }

                    var form = $(this);
                    // Clean up if user went backward before
                    if (currentIndex < newIndex)
                    {
                        // To remove error styles
                        $(".body:eq(" + newIndex + ") label.error", form).remove();
                        $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
                    }

                    // Disable validation on fields that are disabled or hidden.
                    form.validate().settings.ignore = ":disabled,:hidden";

                    // Start validation; Prevent going forward if false
                    return form.valid();
                },
                
                onStepChanged: function (event, currentIndex, priorIndex)
                {
                    // Suppress (skip) "Warning" step if the user is old enough.
                    if (currentIndex === 2 && priorIndex===1 && checkPhone($("#mobile").val())&& (!isEmpty($("#roles").val())) )
                    {
                        $(this).steps("next");
                    }
                    // Suppress (skip) "Warning" step if the user is old enough and wants to the previous step.
                    if (currentIndex === 2 && priorIndex === 3&& checkPhone($("#mobile").val()) && (!isEmpty($("#roles").val())) )
                    {
                        $(this).steps("previous");
                    }
                },
                onFinishing: function (event, currentIndex)
                {
                    var form = $(this);
                    // Disable validation on fields that are disabled.
                    // At this point it's recommended to do an overall check (mean ignoring only disabled fields)
                    form.validate().settings.ignore = ":disabled";
                    // Start validation; Prevent form submission if false
                    return form.valid();
                },
                onFinished: function (event, currentIndex)
                {
                	var username = $('#username').val();
                	var password = $('#password').val();
    				var name = $('#name').val();
    				var email = $('#email').val();
    				var phone = $('#phone').val();
    				var mobile = $('#mobile').val();
    				var roles = $('#roles').val();
    				var jsonRoles = [];
    	        	for(var i=0; i<roles.length;i++){
    	        		var role = {id:roles[i]}
    	        		jsonRoles.push(role);
    	        	}
    	        	var data = {
    		            	'username': username,
    		            	'name': name,
    		            	'email' : email,
    		            	'phone': phone,
    		            	'mobile': mobile,
    		            	'roles' : jsonRoles
    		            	}
    	        	postJson("./admin",data);
                }
            }).validate({
                        errorPlacement: function (error, element)
                        {
                            element.before(error);
                        },
                        rules: {
                            confirm: {
                                equalTo: "#password"
                            }
                        }
                    });
			
			$("#companyForm").steps({
                bodyTag: "fieldset",
                onStepChanging: function (event, currentIndex, newIndex) 
                {
                    // Always allow going backward even if the current step contains invalid fields!
                    if (currentIndex > newIndex)
                    {
                        return true;
                    }

                    var form = $(this);
                    // Clean up if user went backward before
                    if (currentIndex < newIndex)
                    {
                        // To remove error styles
                        $(".body:eq(" + newIndex + ") label.error", form).remove();
                        $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
                    }

                    // Disable validation on fields that are disabled or hidden.
                    form.validate().settings.ignore = ":disabled,:hidden";

                    // Start validation; Prevent going forward if false
                    return form.valid();
                },
                
                onStepChanged: function (event, currentIndex, priorIndex)
                {
                    // Suppress (skip) "Warning" step if the user is old enough.
                    if (currentIndex === 1 && priorIndex===0 && (!isEmpty($("#usernames").val())))
                    {
                        $(this).steps("next");
                    }
                    // Suppress (skip) "Warning" step if the user is old enough and wants to the previous step.
                    if (currentIndex === 1 && priorIndex === 2 && (!isEmpty($("#usernames").val())))
                    {
                        $(this).steps("previous");
                    }
                },
                onFinishing: function (event, currentIndex)
                {
                    var form = $(this);
                    // Disable validation on fields that are disabled.
                    // At this point it's recommended to do an overall check (mean ignoring only disabled fields)
                    form.validate().settings.ignore = ":disabled";
                    // Start validation; Prevent form submission if false
                    return form.valid();
                },
                onFinished: function (event, currentIndex)
                {
                	var companyName = $('#companyName').val();
    				var phone = $('#telephone').val();
    				var address = $('#companyAddress').val();
    				var data = {
    		            	'companyName': companyName,
    		            	'phone': phone,
    		            	'address' : address
    		            	};
    				postJson("./company",data);
                }
            }).validate({
                        errorPlacement: function (error, element)
                        {
                            element.before(error);
                        }
                    });
			
			$("#deviceForm").steps({
	            bodyTag: "fieldset",
	            onStepChanging: function (event, currentIndex, newIndex) 
	            {
	                // Always allow going backward even if the current step contains invalid fields!
	                if (currentIndex > newIndex)
	                {
	                    return true;
	                }

	                var form = $(this);
	                // Clean up if user went backward before
	                if (currentIndex < newIndex)
	                {
	                    // To remove error styles
	                    $(".body:eq(" + newIndex + ") label.error", form).remove();
	                    $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
	                }
	                form.validate().settings.ignore = ":disabled,:hidden";
	                return form.valid();
	            },
	            
	            onStepChanged: function (event, currentIndex, priorIndex)
	            {
	            	if(currentIndex === 2 && priorIndex===1 ){
	            		if($("#inlineRadio1").prop("checked") && ($("#pricePlan").val()!=-1)){
	            			$(this).steps("next");
	            		}
	            		if($("#inlineRadio2").prop("checked") && ($("#pricePlan").val()==-1)){
	            			$(this).steps("next");
	            		}
	            	}
	            },
	            onFinishing: function (event, currentIndex)
	            {
	                var form = $(this);
	                form.validate().settings.ignore = ":disabled";
	                return form.valid();
	            },
	            onFinished: function (event, currentIndex)
	            {
	            	var scaNum = $('#scaNum').val();
					var colType = $('#colType').val();
					var companys = $('#companys').val();
					var company = {id:companys};
					var scadaDto = {
						'scaNum': scaNum,
			            'colType': colType,
			            'companyDto' : company
					}
					var custName = $('#customerName').val();
					var custAddress = $('#customerAddress').val();
					var userDto = {customerName:custName,customerAddress:custAddress};
					scadaDto.userDto = userDto;
					var pricePlan = $("#pricePlan").val();
					var exPricePlan = $("#exPricePlan").val();
					var icDevice = $("#inlineRadio1").prop("checked");
					var colDevice = $("#inlineRadio2").prop("checked");
					var pPlan = {id:pricePlan};
					var ePlan = {id:exPricePlan};
					if(pPlan.id == -1){
						pPlan = null;
					}
					if(ePlan.id == -1){
						ePlan =null;
					}
					var scaParamsDto = {pricePlanDto:pPlan,exPricePlanDto:ePlan};
					if(icDevice){//IC设备
						scadaDto.scaParamsDto = scaParamsDto;
						scadaDto.deviceType = "PrepaymentIC";
					}
					if(colDevice){//采集设备
						scadaDto.deviceType = "CollectionDevice";
					}
					postJson("./scada",scadaDto);
	            }
	        }).validate({
	                    errorPlacement: function (error, element)
	                    {
	                        element.before(error);
	                    }
	                });
	   });
		/**/
        
   
    </script>

</body>

</html>
